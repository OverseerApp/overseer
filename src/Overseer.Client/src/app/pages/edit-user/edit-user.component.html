<div class="container-fluid p-0">
  <div class="d-flex align-items-center mb-4">
    <a
      routerLink="/settings/users"
      class="btn btn-link text-secondary p-0 me-3"
    >
      <i class="bi bi-arrow-left fs-4"></i>
    </a>
    <h4 class="mb-0">
      <i class="bi bi-person-fill-gear text-primary me-2"></i>
      {{ 'editingUser' | i18next }} <span class="text-info font-monospace">{{ user()?.username }}</span>
    </h4>
  </div>
  <div class="row g-4 mb-4">
    <div class="col-lg-6 flex-1">
      <app-card-section
        icon="bi-person-badge"
        [heading]="'userSettings' | i18next"
        class="h-100"
      >
        <form
          class="card-body d-flex flex-column"
          [formGroup]="updateForm"
          (submit)="save()"
        >
          <div class="mb-3">
            <label
              for="accessLevel"
              class="form-label small fw-bold"
              >{{ 'accessLevel' | i18next }}</label
            >
            <select
              id="accessLevel"
              class="form-select border-secondary"
              formControlName="accessLevel"
            >
              @for (option of accessLevels(); track option.value) {
                <option [ngValue]="option.value">{{ option.translationKey | i18next }}</option>
              }
            </select>
          </div>
          <div class="mb-4">
            <label
              for="sessionLifetime"
              class="form-label small fw-bold"
              >{{ 'sessionLifetime' | i18next }}</label
            >
            <select
              required
              id="sessionLifetime"
              class="form-select border-secondary"
              formControlName="sessionLifetime"
            >
              @for (option of lifetimes(); track option.value) {
                <option [ngValue]="option.value">{{ option.value }} {{ option.translationKey | i18next }}</option>
              }
            </select>
          </div>
          <div class="d-flex flex-wrap gap-2 justify-content-end">
            <button
              type="submit"
              class="btn btn-primary px-4"
              [disabled]="updateForm.pristine || updateForm.invalid || updateForm.disabled"
            >
              <i class="bi bi-check-lg me-2"></i>{{ 'save' | i18next }}
            </button>
          </div>
        </form>
      </app-card-section>
    </div>

    @if (isOwnProfile() || user()?.accessLevel === 'Readonly') {
      <div class="col-lg-6 flex-1">
        <app-change-password [user]="user()" />
      </div>
    }
  </div>
</div>

@if (displayMagicLink()) {
  <app-magic-link [user]="user()" />
}

<div class="col-12 mt-4">
  <div class="card border-danger bg-opacity-25 shadow-sm">
    <div class="card-body d-flex flex-wrap align-items-center justify-content-between gap-3">
      <div>
        <h6 class="mb-1 fw-bold text-danger"><i class="bi bi-exclamation-octagon me-2"></i>{{ 'dangerZone' | i18next }}</h6>
        <p class="text-muted small mb-0">{{ 'userDangerZoneDescription' | i18next }}</p>
      </div>
      <div class="d-flex gap-2">
        <button
          type="button"
          class="btn btn-outline-warning btn-sm"
          (click)="signOut()"
        >
          <i class="bi bi-box-arrow-right me-2"></i>{{ 'logout' | i18next }}
        </button>
        <button
          type="button"
          class="btn btn-outline-danger btn-sm"
          (click)="deleteUser()"
        >
          <i class="bi bi-trash3 me-2"></i>{{ 'delete' | i18next }}
        </button>
      </div>
    </div>
  </div>
</div>
